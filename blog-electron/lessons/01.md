# electron 入门

官网：https://electronjs.org/

## 安装

```bash
# 使用cnpm，防止报这个错误：Error: EPERM: operation not permitted、add 1 或者 node install.js中
npm install -g cnpm --registry=https://registry.npm.taobao.org
# 克隆示例项目的仓库
$ git clone https://github.com/electron/electron-quick-start
# 进入这个仓库
$ cd electron-quick-start
# 安装依赖并运行
$ npm install && npm start
```

## 运行机制

```
1. electron分为渲染进程与主进程
1）渲染进程：web界面，包括html，css，js
2）主进程：electron运行package.json的main脚本的进程
3）在主进程中运行的脚本通过创建web页面来展示用户界面，一个electron应用只有一个主进程
```

## 渲染进程与主进程调试

```
1. 渲染进程调试和chrome调试一样
2. 主进程调试方式1
  1）执行electron --inspect=[port] .
  2）chrome输入chrome://inspect
  3）加一个localhost:[port]
3. vscode在launch.json添加配置文件即可
```

## 生命周期

文档：https://electronjs.org/docs/all

1. app 事件

```
1. 当 Electron 完成初始化时被触发
app.on('ready', callback)
2. 在应用程序退出时发出
app.on('quit', callback)
3. 当应用被激活时发出
app.on('activate', callback)
4. 退出窗口
app.on("window-all-closed",callback)
```

2. webContents 常用事件

```
1. 导航完成时触发，即选项卡的旋转器将停止旋转，并指派onload事件后
mainWindow.webContents.on('did-finish-load', callback)
2. 一个框架中的文本加载完成后触发该事件。
mainWindow.webContents.on('dom-ready', callback)
```

## 进程

1. 如何在渲染进程中打印 process

```js
// https://electronjs.org/docs/all#new-browserwindowoptions
// mian.js
// Create the browser window.
mainWindow = new BrowserWindow({
  width: 800,
  height: 600,
  webPreferences: {
    preload: path.join(__dirname, "preload.js"),
    // nodeIntegration Boolean (可选) - 是否集成Node，默认为false
    nodeIntegration: true
  }
});
```

```txt
1. cpu信息
getCPUUsage()
2. 内存信息
getSystemMemoryInfo()
3. 环境变量
env
```

## file 对象

```txt
在文件系统中，使用HTML5 File 原生API操作文件
```

```js
const fs = require("fs");
const iconv = require("iconv-lite");
const $drag_file = document.getElementById("drag_file");
$drag_file.addEventListener("drop", e => {
  e.preventDefault();
  const files = e.dataTransfer.files;
  fs.readFile(files[0].path, (err, data) => {
    var content = iconv.decode(data, "gbk");
    console.log(content);
  });
});
$drag_file.addEventListener("dragover", e => {
  e.preventDefault();
});
```

## webview

```txt
https://electronjs.org/docs/all#webview%E6%A0%87%E7%AD%BE
需要在perload.js开启webviewTag
```

```js
const webview = document.querySelector("webview");
webview.addEventListener("did-start-loading", e => {
  console.log("did-start-loading", e);
});
webview.addEventListener("did-stop-loading", e => {
  console.log("did-stop-loading", e);
});
```
