# è®¾è®¡æ¨¡å¼-å·¥å‚æ¨¡å¼

## ä»€ä¹ˆæ˜¯å·¥å‚æ¨¡å¼

1. å½“å»ä¹°ä¸€ä¸ª ğŸ” çš„æ—¶å€™ï¼Œæ— é¡»å¾—åˆ° ğŸ” çš„åŸææ–™ï¼Œåªéœ€è¦è·å¾—åˆ° ğŸ”
2. å¯¹åº”å·¥å‚æ¨¡å¼ï¼šä¸æš´éœ²åˆ›å»ºå¯¹è±¡çš„å…·ä½“é€»è¾‘ï¼Œå°†åˆ›å»ºå¯¹è±¡çš„æ–¹æ³•å°è£…åˆ°ä¸€ä¸ªå‡½æ•°ä¸­ï¼Œè¿™ä¸ªå‡½æ•°å°±æ˜¯ä¸€ä¸ªå·¥å‚
3. å·¥å‚æ¨¡å¼æŒ‰ç…§æŠ½è±¡ç¨‹åº¦å¯ä»¥åˆ†ä¸ºï¼š1.ç®€å•å·¥å‚æ¨¡å¼ 2.å·¥å‚æ–¹æ³•æ¨¡å¼ 3.æŠ½è±¡å·¥å‚æ¨¡å¼

## ä»€ä¹ˆæ—¶å€™ç”¨å·¥å‚æ¨¡å¼

1. å¯¹å®ä¾‹çš„å°è£…ï¼Œä½¿ç”¨ new æ“ä½œç¬¦æ—¶å€™å¯ä»¥è€ƒè™‘ç”¨å·¥å‚æ¨¡å¼

## èº«è¾¹çš„å·¥å‚æ¨¡å¼

1. \$(selector)
   > \$()å°±æ˜¯ä¸€ä¸ªç®€å•å·¥å‚æ¨¡å¼

```js
function jQuery() {}
jQuery.prototype.extend = function() {};
// ...
window.$ = function(selector) {
  return new jQuery(selector);
};
```

## å·¥å‚æ¨¡å¼çš„ç±»å‹

1. ç®€å•å·¥å‚æ¨¡å¼

```js
function CreatePerson(name, age, sex) {
  var obj = Object.create(null);
  obj.name = name;
  obj.age = age;
  obj.sex = sex;
  obj.getData = function() {
    console.log(this.name, this.age, this.sex);
  };
  return obj;
}
function factory(name, age, sex) {
  return new CreatePerson(name, age, sex);
}
var p1 = factory('express', 21, 1);
var p2 = factory('egg', 22, 0);
p1.getData();
p2.getData();
// è¾“å‡º
// express 21 1
// egg 22 0
```

```js
// ç®€å•å·¥å‚æ¨¡å¼
// åªéœ€è¦ä¸€ä¸ªæ­£ç¡®çš„å‚æ•°ï¼Œå°±å¯ä»¥å¾—åˆ°ç»“æœï¼Œä¸éœ€è¦çŸ¥é“åˆ›å»ºçš„è¿‡ç¨‹
// ä¸åŒç”¨æˆ·åˆ†é…ä¸åŒæƒé™
// å¦‚æœè§’è‰²å˜å¤šï¼Œé‚£ä¹ˆå°±getInstanceå˜çš„å¾ˆåºå¤§ï¼Œæ¯”è¾ƒéš¾ç»´æŠ¤ï¼Œæ‰€ä»¥é€‚ç”¨äºåˆ›å»ºå¯¹è±¡è¾ƒå°‘çš„æƒ…å†µ
class User {
  //æ„é€ å™¨
  constructor(option) {
    this.role = option.role;
    this.limit = option.limit;
  }

  //é™æ€æ–¹æ³•
  static getInstance(role) {
    switch (role) {
      case 'superAdmin':
        return new User({
          role: 'è¶…çº§ç®¡ç†å‘˜',
          limit: ['é¦–é¡µ', 'é€šè®¯å½•', 'å‘ç°é¡µ', 'åº”ç”¨æ•°æ®', 'æƒé™ç®¡ç†']
        });
        break;
      case 'admin':
        return new User({
          role: 'ç®¡ç†å‘˜',
          limit: ['é¦–é¡µ', 'é€šè®¯å½•', 'å‘ç°é¡µ', 'åº”ç”¨æ•°æ®']
        });
        break;
      case 'user':
        return new User({
          role: 'æ™®é€šç”¨æˆ·',
          limit: ['é¦–é¡µ', 'é€šè®¯å½•', 'å‘ç°é¡µ']
        });
        break;
      default:
        throw new Error('å‚æ•°é”™è¯¯, å¯é€‰å‚æ•°:superAdminã€adminã€user');
    }
  }
}
let superAdmin = User.getInstance('superAdmin');
let admin = User.getInstance('admin');
let normalUser = User.getInstance('user');
console.log(superAdmin);
console.log(admin);
console.log(normalUser);
// è¾“å‡º
// role: "è¶…çº§ç®¡ç†å‘˜", limit['é¦–é¡µ', 'é€šè®¯å½•', 'å‘ç°é¡µ', 'åº”ç”¨æ•°æ®', 'æƒé™ç®¡ç†']
// role: "ç®¡ç†å‘˜", limit['é¦–é¡µ', 'é€šè®¯å½•', 'å‘ç°é¡µ', 'åº”ç”¨æ•°æ®']
// role: "æ™®é€šç”¨æˆ·", limit['é¦–é¡µ', 'é€šè®¯å½•', 'å‘ç°é¡µ']
```

2. å·¥å‚æ–¹æ³•æ¨¡å¼
   > æŠŠå®é™…åˆ›å»ºå¯¹è±¡æ”¾åˆ°å­ç±»ä¸­

```js
// å·¥å‚æ–¹æ³•æ¨¡å¼
// æŠŠå®é™…åˆ›å»ºå¯¹è±¡æ”¾åˆ°å­ç±»ä¸­ï¼Œçˆ¶ç±»å°±æ˜¯ä¸€ä¸ªæŠ½è±¡ç±»ï¼ŒES6ä¸­æ²¡æœ‰ abstractä¿®é¥°ç¬¦ï¼Œæ‰€ä»¥å¯ä»¥åˆ¤æ–­ new.target==çˆ¶ç±»çš„æ„é€ å‡½æ•°ï¼ŒæŠ›å‡ºå¼‚å¸¸
class User {
  //æ„é€ å™¨
  constructor(option = {}) {
    if (new.target == User) {
      throw new Error('çˆ¶ç±»æ˜¯æŠ½è±¡ç±»ï¼Œä¸èƒ½ç›´æ¥è°ƒç”¨ï¼Œéœ€è¦é‡å†™è¯¥æ–¹æ³•');
    }
    this.role = option.role;
    this.limit = option.limit;
  }
}
class UserFactory extends User {
  constructor(option) {
    super(option);
  }
  create(role) {
    switch (role) {
      case 'superAdmin':
        return new UserFactory({
          role: 'è¶…çº§ç®¡ç†å‘˜',
          limit: ['é¦–é¡µ', 'é€šè®¯å½•', 'å‘ç°é¡µ', 'åº”ç”¨æ•°æ®', 'æƒé™ç®¡ç†']
        });
        break;
      case 'admin':
        return new UserFactory({
          role: 'ç®¡ç†å‘˜',
          limit: ['é¦–é¡µ', 'é€šè®¯å½•', 'å‘ç°é¡µ', 'åº”ç”¨æ•°æ®']
        });
        break;
      case 'user':
        return new UserFactory({
          role: 'æ™®é€šç”¨æˆ·',
          limit: ['é¦–é¡µ', 'é€šè®¯å½•', 'å‘ç°é¡µ']
        });
        break;
      default:
        throw new Error('å‚æ•°é”™è¯¯, å¯é€‰å‚æ•°:superAdminã€adminã€user');
    }
  }
}
var userFactory = new UserFactory();
let superAdmin = userFactory.create('superAdmin');
let admin = userFactory.create('admin');
let normalUser = userFactory.create('user');
console.log(superAdmin);
console.log(admin);
console.log(normalUser);
// è¾“å‡º
// role: "è¶…çº§ç®¡ç†å‘˜", limit['é¦–é¡µ', 'é€šè®¯å½•', 'å‘ç°é¡µ', 'åº”ç”¨æ•°æ®', 'æƒé™ç®¡ç†']
// role: "ç®¡ç†å‘˜", limit['é¦–é¡µ', 'é€šè®¯å½•', 'å‘ç°é¡µ', 'åº”ç”¨æ•°æ®']
// role: "æ™®é€šç”¨æˆ·", limit['é¦–é¡µ', 'é€šè®¯å½•', 'å‘ç°é¡µ']
```

## æŠ½è±¡å·¥å‚æ¨¡å¼

1. ğŸŒ°

```js
// æŠ½è±¡å·¥å‚æ¨¡å¼
// æœ‰äº†3ä¸­è§’è‰²ï¼Œè¿™ä¸‰ç§è§’è‰²çš„æ³¨å†Œæ–¹å¼å¯ä»¥æ˜¯qqï¼Œå¾®ä¿¡ï¼Œå¾®åšï¼Œé‚£åˆ¤æ–­è¿™ä¸ªæ¥æºå°±å¯ä»¥æ”¾åœ¨çˆ¶ç±»åšï¼Œè®©å­ç±»ç»§æ‰¿çˆ¶ç±»æ–¹æ³•
class User {
  //æ„é€ å™¨
  constructor(option = {}) {
    if (new.target == User) {
      throw new Error('çˆ¶ç±»æ˜¯æŠ½è±¡ç±»ï¼Œä¸èƒ½ç›´æ¥è°ƒç”¨ï¼Œéœ€è¦é‡å†™è¯¥æ–¹æ³•');
    }
    this.role = option.role;
    this.limit = option.limit;
    this.type = '';
  }
  getFrom(type) {
    switch (type) {
      case 'weixin':
        this.type = 'æ¥è‡ªå¾®ä¿¡';
        break;
      case 'qq':
        this.type = 'æ¥è‡ªqq';
        break;
      case 'weibo':
        this.type = 'æ¥è‡ªå¾®åš';
        break;
      default:
        throw new Error('å‚æ•°é”™è¯¯:æ¥è‡ªç«æ˜Ÿ');
    }
  }
}
class UserFactory extends User {
  constructor(option = {}) {
    super(option);
    if (option.type) {
      this.getFrom(option.type);
    }
  }
  create(role) {
    switch (role) {
      case 'superAdmin':
        return new UserFactory({
          role: 'è¶…çº§ç®¡ç†å‘˜',
          limit: ['é¦–é¡µ', 'é€šè®¯å½•', 'å‘ç°é¡µ', 'åº”ç”¨æ•°æ®', 'æƒé™ç®¡ç†'],
          type: 'weixin'
        });
        break;
      case 'admin':
        return new UserFactory({
          role: 'ç®¡ç†å‘˜',
          limit: ['é¦–é¡µ', 'é€šè®¯å½•', 'å‘ç°é¡µ', 'åº”ç”¨æ•°æ®'],
          type: 'qq'
        });
        break;
      case 'user':
        return new UserFactory({
          role: 'æ™®é€šç”¨æˆ·',
          limit: ['é¦–é¡µ', 'é€šè®¯å½•', 'å‘ç°é¡µ'],
          type: 'weibo'
        });
        break;
      default:
        throw new Error('å‚æ•°é”™è¯¯');
    }
  }
}
var userFactory = new UserFactory();
let superAdmin = userFactory.create('superAdmin');
let admin = userFactory.create('admin');
let normalUser = userFactory.create('user');
console.log(superAdmin);
console.log(admin);
console.log(normalUser);
// è¾“å‡º
// UserFactoryÂ {role: "è¶…çº§ç®¡ç†å‘˜", limit: Array(5), type: "æ¥è‡ªå¾®ä¿¡"}
// UserFactoryÂ {role: "ç®¡ç†å‘˜", limit: Array(4), type: "æ¥è‡ªqq"}
// UserFactoryÂ {role: "æ™®é€šç”¨æˆ·", limit: Array(3), type: "æ¥è‡ªå¾®åš"}
```

2. ğŸŒ°

```js
// Subæ˜¯å­ç±»ï¼ŒSupæ˜¯è¶…ç±»
function _extend(Sub, Sup) {
  // å®šä¹‰ä¸€ä¸ªç©ºå‡½æ•°
  var F = function() {};
  // ç©ºå‡½æ•°åŸå‹ä¸ºè¶…ç±»åŸå‹
  F.prototype = Sup.prototype;
  // å®ä¾‹åŒ–ç©ºå‡½æ•°ï¼ŒæŠŠè¶…ç±»åŸå‹å¼•ç”¨ä¼ é€’ç»™å­ç±»åŸå‹
  Sub.prototype = new F();
  // é‡ç½®å­ç±»åŸå‹æ„é€ å‡½æ•°ä¸ºå­ç±»æœ¬èº«
  Sub.prototype.constructor = Sub;
  // åœ¨å­ç±»ä¿å­˜è¶…ç±»åŸå‹ï¼Œé¿å…å­ç±»ä¸è¶…ç±»è€¦åˆ
  Sub.sup = Sup.prototype;
  // æ£€æµ‹è¶…ç±»åŸå‹çš„æ„é€ å‡½æ•°æ˜¯å¦ä¸ºåŸå‹æœ¬èº«ï¼Œå¦‚æœæ˜¯åŸå‹æœ¬èº«ï¼Œé‡ç½®è¶…ç±»åŸå‹æ„é€ å‡½æ•°ä¸ºè¶…ç±»æœ¬èº«
  if (Sup.prototype.constructor === Object.prototype.constructor) {
    Sup.prototype.constructor = Sup;
  }
}
// å¤§å·¥å‚
var BigFactory = function(product2) {
  this.product1 = 'æ‰‹æœº';
  this.product2 = product2;
  this.get = function() {
    console.log(`æˆ‘æ˜¯å¤§å·¥å‚ï¼Œæˆ‘è‡ªå·±åˆ¶ä½œäº†${this.product1}ï¼Œæˆ‘å¯ä»¥è·å–åˆ°å°å·¥å‚åˆ¶ä½œçš„${this.product2}`);
  };
};
// å¤§å·¥å‚çš„åŸå‹æ–¹æ³•
BigFactory.prototype = {
  constructor: BigFactory,
  // å¤§å·¥å‚æ‰§è¡Œå°å·¥å‚çš„åˆ¶ä½œåŠ¨ä½œ
  run: function() {
    this.make().A();
  },
  make: function() {
    // åˆ¶ä½œç”±å°å·¥å‚åš
    throw new Error('çˆ¶ç±»æ˜¯æŠ½è±¡ç±»ï¼Œä¸èƒ½ç›´æ¥è°ƒç”¨ï¼Œéœ€è¦é‡å†™è¯¥æ–¹æ³•');
  }
};
// å°å·¥å‚
var SmallFactory = function(product2) {
  BigFactory.call(this, product2);
};
// å°å·¥å‚ç»§æ‰¿ä¸å¤§å·¥å‚
_extend(SmallFactory, BigFactory);
// å°å·¥å‚åŸå‹ä¸Šæœ‰ä¸€ä¸ªåˆ¶ä½œåŠ¨ä½œ
SmallFactory.prototype.make = function() {
  var that = this;
  var A = function() {
    console.log(`æˆ‘æ˜¯å°å·¥å‚ï¼Œæˆ‘åœ¨åˆ¶ä½œ${that.product2}`);
  };
  return {
    A
  };
};
var smallFactory = new SmallFactory('æ‰‹æœºå£³');
smallFactory.run();
smallFactory.get();
// è¾“å‡º
// æˆ‘æ˜¯å°å·¥å‚ï¼Œæˆ‘åœ¨åˆ¶ä½œæ‰‹æœºå£³
// æˆ‘æ˜¯å¤§å·¥å‚ï¼Œæˆ‘è‡ªå·±åˆ¶ä½œäº†æ‰‹æœºï¼Œæˆ‘å¯ä»¥è·å–åˆ°å°å·¥å‚åˆ¶ä½œçš„æ‰‹æœºå£³
```

3. ğŸŒ°2 çš„æ¼”å˜

```js
class BigFactory {
  constructor(product2) {
    (this.product1 = 'æ‰‹æœº'), (this.product2 = product2);
  }
  get() {
    console.log(`æˆ‘æ˜¯å¤§å·¥å‚ï¼Œæˆ‘è‡ªå·±åˆ¶ä½œäº†${this.product1}ï¼Œæˆ‘å¯ä»¥è·å–åˆ°å°å·¥å‚åˆ¶ä½œçš„${this.product2}`);
  }
  run() {
    this.make().A();
  }
  make() {
    throw new Error('çˆ¶ç±»æ˜¯æŠ½è±¡ç±»ï¼Œä¸èƒ½ç›´æ¥è°ƒç”¨ï¼Œéœ€è¦é‡å†™è¯¥æ–¹æ³•');
  }
}
class SmallFactory extends BigFactory {
  constructor(product2) {
    super(product2);
  }
  make() {
    var A = () => {
      console.log(`æˆ‘æ˜¯å°å·¥å‚ï¼Œæˆ‘åœ¨åˆ¶ä½œ${this.product2}`);
    };
    return {
      A
    };
  }
}
var smallFactory = new SmallFactory('æ‰‹æœºå£³');
smallFactory.run();
smallFactory.get();
// è¾“å‡º
// æˆ‘æ˜¯å°å·¥å‚ï¼Œæˆ‘åœ¨åˆ¶ä½œæ‰‹æœºå£³
// æˆ‘æ˜¯å¤§å·¥å‚ï¼Œæˆ‘è‡ªå·±åˆ¶ä½œäº†æ‰‹æœºï¼Œæˆ‘å¯ä»¥è·å–åˆ°å°å·¥å‚åˆ¶ä½œçš„æ‰‹æœºå£³
```

## å·¥å‚æ¨¡å¼åœ¨ vue-router çš„åº”ç”¨

```js
// vueè·¯ç”±ä¾‹å­
// router/index.js
import Vue from 'vue';
import Router from 'vue-router';
import Login from 'login.vue';

Vue.use(Router);

export default new Router({
  routes: [
    //é‡å®šå‘åˆ°ç™»å½•é¡µ
    {
      path: '/',
      redirect: '/login'
    },
    //ç™»é™†é¡µ
    {
      path: '/login',
      name: 'Login',
      component: Login
    }
  ]
});
// router/routerFactor.js
import A from 'a.vue';
import B from 'b.vue';
import C from 'c.vue';
import D from 'd.vue';

class User {
  //æ„é€ å™¨
  constructor(option = {}) {
    if (new.target == User) {
      throw new Error('çˆ¶ç±»æ˜¯æŠ½è±¡ç±»ï¼Œä¸èƒ½ç›´æ¥è°ƒç”¨ï¼Œéœ€è¦é‡å†™è¯¥æ–¹æ³•');
    }
    this.role = option.role;
    this.limit = option.limit;
    this.route = [];
  }
  setLimit() {
    for (let ele of this.limit) {
      this.route.push(User.allRoute[ele]);
    }
  }
  static allRoute = {
    // A
    a: {
      path: '/a',
      name: 'A',
      component: A
    },
    // B
    b: {
      path: '/b',
      name: 'B',
      component: B
    },
    // C
    c: {
      path: '/user',
      name: 'C',
      component: C
    },
    // D
    d: {
      path: '*',
      name: 'D',
      component: D
    }
  };
}
class UserFactory extends User {
  constructor(option) {
    super(option);
    if (option) {
      this.setLimit();
    }
  }
  create(role) {
    switch (role) {
      case 'superAdmin':
        return new UserFactory({
          role: 'è¶…çº§ç®¡ç†å‘˜',
          limit: ['a', 'b', 'c', 'd']
        });
        break;
      case 'admin':
        return new UserFactory({
          role: 'ç®¡ç†å‘˜',
          limit: ['b', 'c', 'd']
        });
        break;
      case 'user':
        return new UserFactory({
          role: 'æ™®é€šç”¨æˆ·',
          limit: ['c', 'd']
        });
        break;
      default:
        throw new Error('å‚æ•°é”™è¯¯, å¯é€‰å‚æ•°:superAdminã€adminã€user');
    }
  }
}
var userFactory = new UserFactory();
let superAdmin = userFactory.create('superAdmin');
let admin = userFactory.create('admin');
let normalUser = userFactory.create('user');

// è¿™æ ·å°±æŠŠä¸åŒæƒé™çš„è·¯ç”±è·å–åˆ°äº†
var result1 = superAdmin.route;
var result2 = admin.route;
var result3 = normalUser.route;
```
